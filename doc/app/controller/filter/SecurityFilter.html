<!DOCTYPE HTML>
<!-- NewPage -->
<html lang="ru">
<head>
<!-- Generated by javadoc (15) on Fri Apr 30 09:25:56 MSK 2021 -->
<title>SecurityFilter</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="dc.created" content="2021-04-30">
<meta name="description" content="declaration: package: app.controller.filter, class: SecurityFilter">
<meta name="generator" content="javadoc/ClassWriterImpl">
<link rel="stylesheet" type="text/css" href="../../../stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../script-dir/jquery-ui.min.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../jquery-ui.overrides.css" title="Style">
<script type="text/javascript" src="../../../script.js"></script>
<script type="text/javascript" src="../../../script-dir/jquery-3.5.1.min.js"></script>
<script type="text/javascript" src="../../../script-dir/jquery-ui.min.js"></script>
</head>
<body class="class-declaration-page">
<script type="text/javascript">var data = {"i0":10,"i1":10,"i2":10};
var tabs = {65535:["t0","All Methods"],2:["t2","Instance Methods"],8:["t4","Concrete Methods"]};
var altColor = "alt-color";
var rowColor = "row-color";
var tableTab = "table-tab";
var activeTableTab = "active-table-tab";
var pathtoroot = "../../../";
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<div class="flex-box">
<header role="banner" class="flex-header">
<nav role="navigation">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="top-nav" id="navbar.top">
<div class="skip-nav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<ul id="navbar.top.firstrow" class="nav-list" title="Navigation">
<li><a href="../../../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="nav-bar-cell1-rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../index-files/index-1.html">Index</a></li>
<li><a href="../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="sub-nav">
<div>
<ul class="sub-nav-list">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field.summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="sub-nav-list">
<li>Detail:&nbsp;</li>
<li><a href="#field.detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<div class="nav-list-search"><label for="search">SEARCH:</label>
<input type="text" id="search" value="search" disabled="disabled">
<input type="reset" id="reset" value="reset" disabled="disabled">
</div>
</div>
<!-- ========= END OF TOP NAVBAR ========= -->
<span class="skip-nav" id="skip.navbar.top">
<!--   -->
</span></nav>
</header>
<div class="flex-content">
<main role="main">
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="sub-title"><span class="package-label-in-type">Package</span>&nbsp;<a href="package-summary.html">app.controller.filter</a></div>
<h1 title="Class SecurityFilter" class="title">Class SecurityFilter</h1>
</div>
<div class="inheritance" title="Inheritance Tree">java.lang.Object
<div class="inheritance">app.controller.filter.SecurityFilter</div>
</div>
<section class="description">
<dl class="notes">
<dt>All Implemented Interfaces:</dt>
<dd><code>javax.servlet.Filter</code></dd>
</dl>
<hr>
<pre>public class <span class="type-name-label">SecurityFilter</span>
extends java.lang.Object
implements javax.servlet.Filter</pre>
<div class="block">Filter for validating requests and filling authorisation context.</div>
</section>
<section class="summary">
<ul class="summary-list">
<!-- =========== FIELD SUMMARY =========== -->
<li>
<section class="field-summary" id="field.summary">
<h2>Field Summary</h2>
<div class="member-summary">
<table class="summary-table">
<caption><span>Fields</span></caption>
<thead>
<tr>
<th class="col-first" scope="col">Modifier and Type</th>
<th class="col-second" scope="col">Field</th>
<th class="col-last" scope="col">Description</th>
</tr>
</thead>
<tbody>
<tr class="alt-color">
<td class="col-first"><code>private <a href="../../security/auth/Auth.html" title="interface in app.security.auth">Auth</a></code></td>
<th class="col-second" scope="row"><code><span class="member-name-link"><a href="#auth">auth</a></span></code></th>
<td class="col-last">
<div class="block">Authorisation context</div>
</td>
</tr>
<tr class="row-color">
<td class="col-first"><code>private <a href="../../database/service/RefreshService.html" title="interface in app.database.service">RefreshService</a></code></td>
<th class="col-second" scope="row"><code><span class="member-name-link"><a href="#refreshService">refreshService</a></span></code></th>
<td class="col-last">
<div class="block">Service for interaction with refresh tokens in the database</div>
</td>
</tr>
</tbody>
</table>
</div>
</section>
</li>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<li>
<section class="constructor-summary" id="constructor.summary">
<h2>Constructor Summary</h2>
<div class="member-summary">
<table class="summary-table">
<caption><span>Constructors</span></caption>
<thead>
<tr>
<th class="col-first" scope="col">Constructor</th>
<th class="col-last" scope="col">Description</th>
</tr>
</thead>
<tbody>
<tr class="alt-color">
<th class="col-constructor-name" scope="row"><code><span class="member-name-link"><a href="#%3Cinit%3E(app.security.auth.Auth,app.database.service.RefreshService)">SecurityFilter</a></span>&#8203;(<a href="../../security/auth/Auth.html" title="interface in app.security.auth">Auth</a>&nbsp;auth,
<a href="../../database/service/RefreshService.html" title="interface in app.database.service">RefreshService</a>&nbsp;refreshService)</code></th>
<td class="col-last">
<div class="block">Class constructor, specifies authorisation context and refresh service</div>
</td>
</tr>
</tbody>
</table>
</div>
</section>
</li>
<!-- ========== METHOD SUMMARY =========== -->
<li>
<section class="method-summary" id="method.summary">
<h2>Method Summary</h2>
<div class="member-summary" id="method-summary-table">
<div class="table-tabs" role="tablist" aria-orientation="horizontal"><button role="tab" aria-selected="true" aria-controls="method-summary-table.tabpanel" tabindex="0" onkeydown="switchTab(event)" id="t0" class="active-table-tab">All Methods</button><button role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" id="t2" class="table-tab" onclick="show(2);">Instance Methods</button><button role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" id="t4" class="table-tab" onclick="show(8);">Concrete Methods</button></div>
<div id="method-summary-table.tabpanel" role="tabpanel">
<table class="summary-table" aria-labelledby="t0">
<thead>
<tr>
<th class="col-first" scope="col">Modifier and Type</th>
<th class="col-second" scope="col">Method</th>
<th class="col-last" scope="col">Description</th>
</tr>
</thead>
<tbody>
<tr class="alt-color" id="i0">
<td class="col-first"><code>void</code></td>
<th class="col-second" scope="row"><code><span class="member-name-link"><a href="#doFilter(javax.servlet.ServletRequest,javax.servlet.ServletResponse,javax.servlet.FilterChain)">doFilter</a></span>&#8203;(javax.servlet.ServletRequest&nbsp;request,
javax.servlet.ServletResponse&nbsp;response,
javax.servlet.FilterChain&nbsp;chain)</code></th>
<td class="col-last">
<div class="block">Filter body.</div>
</td>
</tr>
<tr class="row-color" id="i1">
<td class="col-first"><code>protected <a href="../../database/model/user/User.html" title="class in app.database.model.user">User</a></code></td>
<th class="col-second" scope="row"><code><span class="member-name-link"><a href="#parseUser(javax.servlet.http.HttpServletRequest,javax.servlet.http.HttpServletResponse)">parseUser</a></span>&#8203;(javax.servlet.http.HttpServletRequest&nbsp;request,
javax.servlet.http.HttpServletResponse&nbsp;response)</code></th>
<td class="col-last">
<div class="block">Parses user from the JWT.</div>
</td>
</tr>
<tr class="alt-color" id="i2">
<td class="col-first"><code>protected void</code></td>
<th class="col-second" scope="row"><code><span class="member-name-link"><a href="#updateTokens(javax.servlet.http.HttpServletResponse,app.database.model.Refresh)">updateTokens</a></span>&#8203;(javax.servlet.http.HttpServletResponse&nbsp;response,
<a href="../../database/model/Refresh.html" title="class in app.database.model">Refresh</a>&nbsp;refresh)</code></th>
<td class="col-last">
<div class="block">Change refresh token value and adds cookies to the response, including:
 
  JWT
  Refresh token
 </div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="inherited-list">
<h3 id="methods.inherited.from.class.java.lang.Object">Methods inherited from class&nbsp;java.lang.Object</h3>
<code>clone, equals, finalize, getClass, hashCode, notify, notifyAll, toString, wait, wait, wait</code></div>
<div class="inherited-list">
<h3 id="methods.inherited.from.class.javax.servlet.Filter">Methods inherited from interface&nbsp;javax.servlet.Filter</h3>
<code>destroy, init</code></div>
</section>
</li>
</ul>
</section>
<section class="details">
<ul class="details-list">
<!-- ============ FIELD DETAIL =========== -->
<li>
<section class="field-details" id="field.detail">
<h2>Field Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="refreshService">
<h3>refreshService</h3>
<div class="member-signature"><span class="modifiers">private final</span>&nbsp;<span class="return-type"><a href="../../database/service/RefreshService.html" title="interface in app.database.service">RefreshService</a></span>&nbsp;<span class="member-name">refreshService</span></div>
<div class="block">Service for interaction with refresh tokens in the database</div>
</section>
</li>
<li>
<section class="detail" id="auth">
<h3>auth</h3>
<div class="member-signature"><span class="modifiers">private final</span>&nbsp;<span class="return-type"><a href="../../security/auth/Auth.html" title="interface in app.security.auth">Auth</a></span>&nbsp;<span class="member-name">auth</span></div>
<div class="block">Authorisation context</div>
</section>
</li>
</ul>
</section>
</li>
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<li>
<section class="constructor-details" id="constructor.detail">
<h2>Constructor Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="&lt;init&gt;(app.security.auth.Auth,app.database.service.RefreshService)">
<h3>SecurityFilter</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="member-name">SecurityFilter</span>&#8203;(<span class="parameters"><a href="../../security/auth/Auth.html" title="interface in app.security.auth">Auth</a>&nbsp;auth,
<a href="../../database/service/RefreshService.html" title="interface in app.database.service">RefreshService</a>&nbsp;refreshService)</span></div>
<div class="block">Class constructor, specifies authorisation context and refresh service</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>auth</code> - authorisation context</dd>
<dd><code>refreshService</code> - service for refresh tokens</dd>
</dl>
</section>
</li>
</ul>
</section>
</li>
<!-- ============ METHOD DETAIL ========== -->
<li>
<section class="method-details" id="method.detail">
<h2>Method Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="doFilter(javax.servlet.ServletRequest,javax.servlet.ServletResponse,javax.servlet.FilterChain)">
<h3>doFilter</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="member-name">doFilter</span>&#8203;(<span class="parameters">javax.servlet.ServletRequest&nbsp;request,
javax.servlet.ServletResponse&nbsp;response,
javax.servlet.FilterChain&nbsp;chain)</span>
              throws <span class="exceptions">java.io.IOException,
javax.servlet.ServletException</span></div>
<div class="block">Filter body.
 Checks if JWT cookie exists, in this case validates it, if it's valid, then parses user and fill auth context.
 If JWT cookie doesn't exist or JWT is invalid, then checks refresh token.
 If refresh token cookie exists and the same token is found in the database, parses JWT and attaches it to the
 cookie. Otherwise cleans tokens in the cookie and answers with error code 401.</div>
<dl class="notes">
<dt>Specified by:</dt>
<dd><code>doFilter</code>&nbsp;in interface&nbsp;<code>javax.servlet.Filter</code></dd>
<dt>Parameters:</dt>
<dd><code>request</code> - contains cookie</dd>
<dd><code>response</code> - for attaching tokens and returning error</dd>
<dd><code>chain</code> - other filters</dd>
<dt>Throws:</dt>
<dd><code>java.io.IOException</code> - if error with input output occurs</dd>
<dd><code>javax.servlet.ServletException</code> - if error when <code>chain.doFilter()</code> occurs</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="parseUser(javax.servlet.http.HttpServletRequest,javax.servlet.http.HttpServletResponse)">
<h3>parseUser</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type"><a href="../../database/model/user/User.html" title="class in app.database.model.user">User</a></span>&nbsp;<span class="member-name">parseUser</span>&#8203;(<span class="parameters">javax.servlet.http.HttpServletRequest&nbsp;request,
javax.servlet.http.HttpServletResponse&nbsp;response)</span>
                  throws <span class="exceptions"><a href="../util/exception/missedToken/types/MissedRefreshException.html" title="class in app.controller.util.exception.missedToken.types">MissedRefreshException</a></span></div>
<div class="block">Parses user from the JWT. Checks if JWT cookie exists, in this case validates it, if it's valid, then parses user and fill auth context.
 If JWT cookie doesn't exist or JWT is invalid, then checks refresh token.
 If refresh token cookie exists and the same token is found in the database, parses JWT and attaches it to the
 cookie. Otherwise throws <a href="../util/exception/missedToken/types/MissedRefreshException.html" title="class in app.controller.util.exception.missedToken.types"><code>MissedRefreshException</code></a>.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>request</code> - contains cookie</dd>
<dd><code>response</code> - for attaching tokens and returning error</dd>
<dt>Returns:</dt>
<dd>parsed <a href="../../database/model/user/User.html" title="class in app.database.model.user"><code>User</code></a> object</dd>
<dt>Throws:</dt>
<dd><code><a href="../util/exception/missedToken/types/MissedRefreshException.html" title="class in app.controller.util.exception.missedToken.types">MissedRefreshException</a></code> - if cookie doesn't contain refresh token or it wasn't found in the database</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="updateTokens(javax.servlet.http.HttpServletResponse,app.database.model.Refresh)">
<h3>updateTokens</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="member-name">updateTokens</span>&#8203;(<span class="parameters">javax.servlet.http.HttpServletResponse&nbsp;response,
<a href="../../database/model/Refresh.html" title="class in app.database.model">Refresh</a>&nbsp;refresh)</span></div>
<div class="block">Change refresh token value and adds cookies to the response, including:
 <ul>
 <li> JWT
 <li> Refresh token
 </ul></div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>response</code> - target for attaching tokens</dd>
<dd><code>refresh</code> - refresh token object</dd>
</dl>
</section>
</li>
</ul>
</section>
</li>
</ul>
</section>
<!-- ========= END OF CLASS DATA ========= -->
</main>
<footer role="contentinfo">
<nav role="navigation">
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottom-nav" id="navbar.bottom">
<div class="skip-nav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<ul id="navbar.bottom.firstrow" class="nav-list" title="Navigation">
<li><a href="../../../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="nav-bar-cell1-rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../index-files/index-1.html">Index</a></li>
<li><a href="../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="sub-nav">
<div>
<ul class="sub-nav-list">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field.summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="sub-nav-list">
<li>Detail:&nbsp;</li>
<li><a href="#field.detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
</div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<span class="skip-nav" id="skip.navbar.bottom">
<!--   -->
</span></nav>
</footer>
</div>
</div>
</body>
</html>
